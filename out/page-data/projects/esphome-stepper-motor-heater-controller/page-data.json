{"componentChunkName":"component---src-templates-project-post-js","path":"/projects/esphome-stepper-motor-heater-controller","result":{"data":{"contentfulProjects":{"id":"3eddb16e-3997-5b0c-9703-bc92b0fdfb80","title":"ESPHome Stepper Motor Heater Controller","slug":"esphome-stepper-motor-heater-controller","featureImage":{"gatsbyImageData":{"images":{"sources":[{"srcSet":"https://images.ctfassets.net/o4gibwve10tr/JNDxnREUKujPCEvzEDrmr/f84547f3cf2e82d59d030c6dae096c02/IMG_5015.jpeg?w=240&h=320&q=50&fm=webp 240w,\nhttps://images.ctfassets.net/o4gibwve10tr/JNDxnREUKujPCEvzEDrmr/f84547f3cf2e82d59d030c6dae096c02/IMG_5015.jpeg?w=480&h=640&q=50&fm=webp 480w,\nhttps://images.ctfassets.net/o4gibwve10tr/JNDxnREUKujPCEvzEDrmr/f84547f3cf2e82d59d030c6dae096c02/IMG_5015.jpeg?w=960&h=1280&q=50&fm=webp 960w","sizes":"(min-width: 960px) 960px, 100vw","type":"image/webp"}],"fallback":{"src":"https://images.ctfassets.net/o4gibwve10tr/JNDxnREUKujPCEvzEDrmr/f84547f3cf2e82d59d030c6dae096c02/IMG_5015.jpeg?w=960&h=1280&fl=progressive&q=50&fm=jpg","srcSet":"https://images.ctfassets.net/o4gibwve10tr/JNDxnREUKujPCEvzEDrmr/f84547f3cf2e82d59d030c6dae096c02/IMG_5015.jpeg?w=240&h=320&fl=progressive&q=50&fm=jpg 240w,\nhttps://images.ctfassets.net/o4gibwve10tr/JNDxnREUKujPCEvzEDrmr/f84547f3cf2e82d59d030c6dae096c02/IMG_5015.jpeg?w=480&h=640&fl=progressive&q=50&fm=jpg 480w,\nhttps://images.ctfassets.net/o4gibwve10tr/JNDxnREUKujPCEvzEDrmr/f84547f3cf2e82d59d030c6dae096c02/IMG_5015.jpeg?w=960&h=1280&fl=progressive&q=50&fm=jpg 960w","sizes":"(min-width: 960px) 960px, 100vw"}},"layout":"constrained","backgroundColor":"#280808","width":960,"height":1280}},"description":{"childMarkdownRemark":{"html":"<p>One of the challenges of building a smart home when you don't own a <em>home</em> is creating projects that work with the existing features of the home so it'll be easier when you eventually move out.</p>\n<p>This is another project that I had dreamed up around 2013 from my first apartment. I had written a python script to control this stepper motor connected to a Raspberry Pi. Additionally, I learned how to use AutoDesk Fusion 360 and created a 3D model to hold the livestrong rubber band. I had printed at a hackerspace for about $20, which seemed a bit much for what it is, but that was in the \"early\" and exciting days of 3D printing lol.</p>\n<p>I've since moved a few times and enhanced the setup. I've taken the stepper motor and connected it to an ESP8266 and used Home-Assistant to automate a baseboard heater.</p>\n<p>I've used some screws (that are easily removable) to mount the stepper motor to the baseboard. I used a \"livestrong\" rubber band bracelet as a belt to control the heater knob by tension and friction.</p>\n<p>The code within ESPHome is pretty straightforward. It uses the stepper motor and the temperature sensor to make a \"<a href=\"https://esphome.io/components/climate/bang_bang.html?highlight=bang%20bang\">bang-bang climate controller</a>\". If you're wondering where the name \"Bang-Bang\" controller came from, check <a href=\"https://en.wikipedia.org/wiki/Bang%E2%80%93bang_control\">wikipedia</a>. Basically, it switches between two states (on/off or up/down) to keep something between a desired state.</p>\n<p>In this example, you set the desired temperature and the stepper motor will turn the heater on or off to maintain the heat at that desired temperature.</p>\n<p>Here are a couple pictures of what it looks like:</p>\n<p><img src=\"//images.ctfassets.net/o4gibwve10tr/6WKiLnYFqdRaTg3ywC6SoY/633ac60bc2a7cccc12ea359dbbf67738/IMG_5014.jpeg\" alt=\"ESPHome Stepper Motor Heater Controller 1\"></p>\n<p><img src=\"//images.ctfassets.net/o4gibwve10tr/JNDxnREUKujPCEvzEDrmr/f84547f3cf2e82d59d030c6dae096c02/IMG_5015.jpeg\" alt=\"Cover - ESPHome Stepper Motor Heater Controller\"></p>\n<p><img src=\"//images.ctfassets.net/o4gibwve10tr/2p0gk5N6oPFSuikdWlnzjC/b824dcaa110a985228129c96857f50d9/IMG_5016.jpeg\" alt=\"ESPHome Stepper Motor Heater Controller 2 Top\"></p>\n<p><img src=\"//images.ctfassets.net/o4gibwve10tr/iJ5XsUL7rZXkbAhv31CIz/f04d06ee628a71d622917ffb9bd7a38e/IMG_5017.jpeg\" alt=\"ESPHome Stepper Motor Heater Controller 3 Right Side\"></p>\n<p><img src=\"//images.ctfassets.net/o4gibwve10tr/6OFTIuzz73YiM6liy0oDD0/c3f859b90878b10a1e6e0cb8455926e0/IMG_5020.jpeg\" alt=\"ESPHome Stepper Motor Heater Controller 4 Front\"></p>\n<h1>ESPHome Code:</h1>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\">\n<span class=\"token key atrule\">esphome</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> heater\n  <span class=\"token key atrule\">platform</span><span class=\"token punctuation\">:</span> ESP8266\n  <span class=\"token key atrule\">board</span><span class=\"token punctuation\">:</span> nodemcuv2\n\n<span class=\"token key atrule\">wifi</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ssid</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Network_SSID'</span>\n  <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Network_PW'</span>\n\n<span class=\"token comment\"># Enable logging</span>\n<span class=\"token key atrule\">logger</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token key atrule\">ota</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token key atrule\">api</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> control_stepper\n      <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> int\n      <span class=\"token key atrule\">then</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">stepper.set_target</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> my_stepper\n            <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!lambda</span> <span class=\"token string\">'return target;'</span>\n\n<span class=\"token key atrule\">stepper</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">platform</span><span class=\"token punctuation\">:</span> uln2003\n    <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> my_stepper\n    <span class=\"token key atrule\">pin_a</span><span class=\"token punctuation\">:</span> D1\n    <span class=\"token key atrule\">pin_b</span><span class=\"token punctuation\">:</span> D2\n    <span class=\"token key atrule\">pin_c</span><span class=\"token punctuation\">:</span> D3\n    <span class=\"token key atrule\">pin_d</span><span class=\"token punctuation\">:</span> D4\n    <span class=\"token key atrule\">max_speed</span><span class=\"token punctuation\">:</span> 150 steps/s\n    <span class=\"token key atrule\">step_mode</span><span class=\"token punctuation\">:</span> HALF_STEP <span class=\"token comment\">#WAVE_DRIVE # </span>\n\n<span class=\"token key atrule\">sensor</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">platform</span><span class=\"token punctuation\">:</span> dht\n    <span class=\"token key atrule\">pin</span><span class=\"token punctuation\">:</span> D5\n    <span class=\"token key atrule\">temperature</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Heater Temperature\"</span>\n      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> heater_temperature\n    <span class=\"token key atrule\">humidity</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Heater Humidity\"</span>\n      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> heater_humidity\n    <span class=\"token key atrule\">model</span><span class=\"token punctuation\">:</span> AM2302\n\n<span class=\"token key atrule\">climate</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">platform</span><span class=\"token punctuation\">:</span> bang_bang\n    <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> heater_climate\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> climate\n    <span class=\"token key atrule\">sensor</span><span class=\"token punctuation\">:</span> heater_temperature\n    <span class=\"token key atrule\">default_target_temperature_low</span><span class=\"token punctuation\">:</span> 20 °C\n    <span class=\"token key atrule\">default_target_temperature_high</span><span class=\"token punctuation\">:</span> 22 °C\n\n    <span class=\"token key atrule\">heat_action</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># - switch.turn_on: heater</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">stepper.set_target</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> my_stepper\n          <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> <span class=\"token number\">-5000</span>\n    <span class=\"token key atrule\">cool_action</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># - switch.turn_off: heater</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">stepper.set_target</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> my_stepper\n          <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5000</span>\n    <span class=\"token key atrule\">idle_action</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">stepper.set_target</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> my_stepper\n          <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2500</span>\n</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1>Home Assistant Configuation</h1>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token comment\"># Home Assistant Configuration</span>\n<span class=\"token key atrule\">input_number</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stepper_control</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Stepper Control\n    <span class=\"token key atrule\">initial</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">min</span><span class=\"token punctuation\">:</span> <span class=\"token number\">-3000</span>\n    <span class=\"token key atrule\">max</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span>\n    <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token comment\"># mode: box</span>\n</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1>Home Assistant Automation</h1>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\">\n<span class=\"token comment\"># Home Assistant Automation</span>\n<span class=\"token key atrule\">automation</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">alias</span><span class=\"token punctuation\">:</span> Write Stepper Value to ESP\n    <span class=\"token key atrule\">trigger</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">platform</span><span class=\"token punctuation\">:</span> state\n      <span class=\"token key atrule\">entity_id</span><span class=\"token punctuation\">:</span> input_number.stepper_control\n    <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># Replace livingroom with the name you gave the ESP</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> esphome.heater_control_stepper\n        <span class=\"token key atrule\">data_template</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'{{ trigger.to_state.state | int }}'</span>\n</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I've combined both sections of the Home Assistant side into a file called <code class=\"language-text\">Heater.yaml</code> that sits inside the Packages folder. Be sure to include   <code class=\"language-text\">packages: !include_dir_named packages</code> underneath the <code class=\"language-text\">homeassistant:</code> section at the beginning of your YAML config.</p>\n<p>I've moved again, and this setup is no longer in use because my new place has central heating. Let me know if you have a good use-case for this stepper motor!</p>"}},"createdAt":"2021-02-08T04:15:07.783Z","publishedDate":"2021-02-07"},"contentfulSiteInformation":{"siteUrl":"https://michaellunzer.com","twiteerHandle":"@michaellunzer"}},"pageContext":{"slug":"esphome-stepper-motor-heater-controller"}},"staticQueryHashes":["1194089924","1242132861","1746898652","1794736483","425184262","603260039","868401008"]}